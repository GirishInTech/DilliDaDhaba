{% extends "base.html" %}
{% block title %}Our Menu{% endblock %}
{% block meta_description %}Explore the full menu at Dilli Da Dhaba â€” starters, mains, breads, and more. Authentic North Indian cuisine.{% endblock %}

{% block content %}

<!-- Hero -->
<section class="bg-maroon text-cream py-20 px-4 text-center">
  <p class="section-label-light mb-3">What We Serve</p>
  <h1 class="font-display font-bold text-5xl sm:text-6xl">Our Menu</h1>
  <p class="text-cream/65 mt-4 text-lg max-w-lg mx-auto">
    Every dish cooked fresh, every day â€” straight from our kitchen to your table.
  </p>
</section>

<!-- Main Menu Section -->
<section
  x-data="menuApp()"
  x-init="init()"
  class="py-16 px-4"
>
  <div class="max-w-7xl mx-auto">

    <!-- Filter bar â€” sticky so categories stay accessible while scrolling -->
    <div class="sticky top-16 lg:top-20 z-30 -mx-4 px-4 py-4
                bg-cream/95 backdrop-blur-sm border-b border-cream-dark
                shadow-sm mb-8">

      <div class="flex flex-col sm:flex-row sm:items-center gap-3">

        <!-- Category tabs (horizontally scrollable on mobile) -->
        <div class="flex items-center gap-2 overflow-x-auto pb-1 pt-1 scrollbar-hide flex-1 min-w-0">
          <button
            @click="filterCategory(null)"
            :class="activeCategory === null ? 'tab-active' : 'tab'"
          >All</button>

          {% for cat in categories %}
          <button
            @click="filterCategory({{ cat.id }})"
            :class="activeCategory === {{ cat.id }} ? 'tab-active' : 'tab'"
            data-category-id="{{ cat.id }}"
          >{{ cat.name }}</button>
          {% endfor %}
        </div>

        <!-- Diet filter pills -->
        <div class="flex items-center gap-2 shrink-0 flex-wrap">
          <button @click="dietFilter='all'; loadMenu()"
                  :class="dietFilter==='all' ? 'tab-active' : 'tab'">All</button>
          <button @click="dietFilter='veg'; loadMenu()"
                  :class="dietFilter==='veg' ? 'tab-active' : 'tab'">ğŸŒ¿ Veg</button>
          <button @click="dietFilter='egg'; loadMenu()"
                  :class="dietFilter==='egg' ? 'tab-active' : 'tab'">ğŸ¥š Egg</button>
          <button @click="dietFilter='nonveg'; loadMenu()"
                  :class="dietFilter==='nonveg' ? 'tab-active' : 'tab'">ğŸ”´ Non-Veg</button>
        </div>

      </div>
    </div>

    <!-- Loading state -->
    <div x-show="loading" class="text-center py-20">
      <div class="inline-block w-10 h-10 border-4 border-saffron border-t-transparent rounded-full animate-spin"></div>
      <p class="text-charcoal/60 mt-4">Loading dishesâ€¦</p>
    </div>

    <!-- Empty state -->
    <div x-show="!loading && items.length === 0" class="text-center py-20">
      <p class="text-5xl mb-4">ğŸ½ï¸</p>
      <p class="text-charcoal/60 text-lg">No dishes found for this filter.</p>
    </div>

    <!-- Menu grid -->
    <div x-show="!loading && items.length > 0"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-4"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-6">

      <template x-for="item in items" :key="item.id">
        <div class="dish-card group relative">
          <!-- Diet badge -->
          <div class="absolute top-3 left-3 z-10">
            <span x-show="item.veg && !item.egg"  class="veg-badge">ğŸŸ¢ Veg</span>
            <span x-show="item.egg"               class="egg-badge">ğŸ¥š Egg</span>
            <span x-show="!item.veg && !item.egg" class="nonveg-badge">ğŸ”´ Non-Veg</span>
          </div>

          <!-- Image -->
          <div class="aspect-square overflow-hidden rounded-t-2xl bg-cream-dark">
            <template x-if="item.image_url">
              <img :src="item.image_url" :alt="item.name"
                   loading="lazy"
                   class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"/>
            </template>
            <template x-if="!item.image_url">
              <div class="w-full h-full flex items-center justify-center text-6xl">ğŸ›</div>
            </template>
          </div>

          <!-- Info -->
          <div class="p-2 sm:p-4">
            <span x-text="item.category_name"
                  class="text-xs text-saffron font-semibold uppercase tracking-wider"></span>
            <h3 x-text="item.name"
                class="font-display font-semibold text-maroon text-sm sm:text-base leading-snug mt-0.5"></h3>
            <p x-show="item.description" x-text="item.description"
               class="text-charcoal/60 text-xs mt-1 line-clamp-1 sm:line-clamp-2"></p>

            <!-- Price display -->
            <div class="mt-2 sm:mt-3">
              <template x-if="item.has_half_full">
                <div class="flex gap-1 sm:gap-3 text-xs sm:text-sm flex-wrap">
                  <span class="text-charcoal/70">Half <strong x-text="'â‚¹' + item.price_half" class="text-maroon"></strong></span>
                  <span class="text-charcoal/30 hidden sm:inline">|</span>
                  <span class="text-charcoal/70">Full <strong x-text="'â‚¹' + item.price_full" class="text-maroon"></strong></span>
                </div>
              </template>
              <template x-if="!item.has_half_full">
                <p x-text="'â‚¹' + item.price_regular" class="text-saffron font-bold text-xs sm:text-sm"></p>
              </template>
            </div>
          </div>
        </div>
      </template>
    </div>

  </div>
</section>

{% endblock %}

{% block extra_scripts %}
<script>
function menuApp() {
  return {
    items: [],
    loading: true,
    activeCategory: null,
    dietFilter: 'all',

    async init() {
      await this.loadMenu();
    },

    async filterCategory(id) {
      this.activeCategory = id;
      await this.loadMenu();
    },

    async loadMenu() {
      this.loading = true;
      try {
        const params = new URLSearchParams();
        if (this.activeCategory !== null) params.append('category', this.activeCategory);
        if (this.dietFilter !== 'all') params.append('diet', this.dietFilter);

        const res = await fetch(`/api/menu?${params.toString()}`);
        if (!res.ok) throw new Error('Network error');
        this.items = await res.json();
      } catch (err) {
        console.error('Menu load failed:', err);
        this.items = [];
      } finally {
        this.loading = false;
      }
    },
  };
}
</script>
{% endblock %}
