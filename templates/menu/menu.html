{% extends "base.html" %}
{% block title %}Our Menu{% endblock %}
{% block meta_description %}Explore the full menu at Dilli Da Dhaba ‚Äî starters, mains, breads, and more. Authentic North Indian cuisine.{% endblock %}

{% block content %}

<!-- Hero -->
<section class="bg-maroon text-cream py-20 px-4 text-center">
  <p class="section-label-light mb-3">What We Serve</p>
  <h1 class="font-display font-bold text-5xl sm:text-6xl">Our Menu</h1>
  <p class="text-cream/65 mt-4 text-lg max-w-lg mx-auto">
    Every dish cooked fresh, every day ‚Äî straight from our kitchen to your table.
  </p>
</section>

<!-- Main Menu Section -->
<section
  x-data="menuApp()"
  x-init="init()"
  class="py-16 px-4"
>
  <div class="max-w-7xl mx-auto">

    <!-- Filter bar ‚Äî sticky so categories stay accessible while scrolling -->
    <div class="sticky top-16 lg:top-20 z-30 -mx-4 px-4 py-4
                bg-cream/95 backdrop-blur-sm border-b border-cream-dark
                shadow-sm mb-8">

      <div class="flex flex-col sm:flex-row sm:items-center gap-3">

        <!-- Category tabs (horizontally scrollable on mobile) -->
        <div class="flex items-center gap-2 overflow-x-auto pb-1 pt-1 scrollbar-hide flex-1 min-w-0">
          <button
            @click="filterCategory(null)"
            :class="activeCategory === null ? 'tab-active' : 'tab'"
          >All</button>

          {% for cat in categories %}
          <button
            @click="filterCategory({{ cat.id }})"
            :class="activeCategory === {{ cat.id }} ? 'tab-active' : 'tab'"
            data-category-id="{{ cat.id }}"
          >{{ cat.name }}</button>
          {% endfor %}
        </div>

        <!-- Veg-only toggle -->
        <label class="flex items-center gap-2 cursor-pointer select-none shrink-0
                       bg-white border border-cream-dark rounded-full px-4 py-2">
          <div class="relative w-10 h-5">
            <input type="checkbox" class="sr-only peer" x-model="vegOnly" @change="loadMenu()">
            <div class="absolute inset-0 bg-gray-200 peer-checked:bg-green-500
                        rounded-full transition-colors duration-200"></div>
            <div class="absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow
                        transition-transform duration-200 peer-checked:translate-x-5"></div>
          </div>
          <span class="text-sm font-medium text-maroon">üåø Veg Only</span>
        </label>

      </div>
    </div>

    <!-- Loading state -->
    <div x-show="loading" class="text-center py-20">
      <div class="inline-block w-10 h-10 border-4 border-saffron border-t-transparent rounded-full animate-spin"></div>
      <p class="text-charcoal/60 mt-4">Loading dishes‚Ä¶</p>
    </div>

    <!-- Empty state -->
    <div x-show="!loading && items.length === 0" class="text-center py-20">
      <p class="text-5xl mb-4">üçΩÔ∏è</p>
      <p class="text-charcoal/60 text-lg">No dishes found for this filter.</p>
    </div>

    <!-- Menu grid -->
    <div x-show="!loading && items.length > 0"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-4"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

      <template x-for="item in items" :key="item.id">
        <div class="dish-card group relative">
          <!-- Veg badge -->
          <div class="absolute top-3 left-3 z-10">
            <span x-show="item.veg"  class="veg-badge">üü¢ Veg</span>
            <span x-show="!item.veg" class="nonveg-badge">üî¥ Non-Veg</span>
          </div>

          <!-- Image -->
          <div class="aspect-square overflow-hidden rounded-t-2xl bg-cream-dark">
            <template x-if="item.image_url">
              <img :src="item.image_url" :alt="item.name"
                   loading="lazy"
                   class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"/>
            </template>
            <template x-if="!item.image_url">
              <div class="w-full h-full flex items-center justify-center text-6xl">üçõ</div>
            </template>
          </div>

          <!-- Info -->
          <div class="p-4">
            <span x-text="item.category_name"
                  class="text-xs text-saffron font-semibold uppercase tracking-wider"></span>
            <h3 x-text="item.name"
                class="font-display font-semibold text-maroon text-base leading-snug mt-0.5"></h3>
            <p x-show="item.description" x-text="item.description"
               class="text-charcoal/60 text-xs mt-1 line-clamp-2"></p>

            <!-- Price display -->
            <div class="mt-3">
              <template x-if="item.has_half_full">
                <div class="flex gap-3 text-sm">
                  <span class="text-charcoal/70">Half <strong x-text="'‚Çπ' + item.price_half" class="text-maroon"></strong></span>
                  <span class="text-charcoal/30">|</span>
                  <span class="text-charcoal/70">Full <strong x-text="'‚Çπ' + item.price_full" class="text-maroon"></strong></span>
                </div>
              </template>
              <template x-if="!item.has_half_full">
                <p x-text="'‚Çπ' + item.price_regular" class="text-saffron font-bold text-sm"></p>
              </template>
            </div>
          </div>
        </div>
      </template>
    </div>

  </div>
</section>

{% endblock %}

{% block extra_scripts %}
<script>
function menuApp() {
  return {
    items: [],
    loading: true,
    activeCategory: null,
    vegOnly: false,

    async init() {
      await this.loadMenu();
    },

    async filterCategory(id) {
      this.activeCategory = id;
      await this.loadMenu();
    },

    async loadMenu() {
      this.loading = true;
      try {
        const params = new URLSearchParams();
        if (this.activeCategory !== null) params.append('category', this.activeCategory);
        if (this.vegOnly) params.append('veg', 'true');

        const res = await fetch(`/api/menu?${params.toString()}`);
        if (!res.ok) throw new Error('Network error');
        this.items = await res.json();
      } catch (err) {
        console.error('Menu load failed:', err);
        this.items = [];
      } finally {
        this.loading = false;
      }
    },
  };
}
</script>
{% endblock %}
